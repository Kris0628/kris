<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>充電站加盟分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js CDN for drawing charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- Chart.js DataLabels Plugin CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        /* Custom font for traditional Chinese and Inter for English, ensuring proper display */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #000; /* 純黑背景 */
            color: #fff; /* 白色文字 */
            overflow-x: hidden; /* 防止水平滾動 */
        }

        /* Classes for Apple-like scroll animation effect */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }

        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Base styles for Bento Grid items */
        .bento-item {
            background-color: rgba(255, 255, 255, 0.05); /* 輕微透明背景 */
            border: 1px solid rgba(255, 255, 255, 0.1); /* 淺色邊框 */
            border-radius: 2rem; /* 大圓角 */
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px); /* 輕微模糊效果 */
            -webkit-backdrop-filter: blur(5px); /* Safari 支援 */
        }

        /* Highlight gradient effects */
        .highlight-gradient-emerald {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.2) 0%, rgba(52, 211, 153, 0) 100%); /* 祖母綠漸層 */
        }
        .highlight-gradient-cyan {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(6, 182, 212, 0) 100%); /* 青色漸層 */
        }
        .highlight-gradient-purple {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0) 100%); /* 紫色漸層 */
        }

        /* Ensure each "page" section takes full viewport height and width */
        .full-page-section {
            width: 100vw;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem 2rem;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .full-page-section {
                padding: 2rem 1rem;
            }
            /* Adjusted font sizes for smaller screens */
            .text-7xl { font-size: 3rem; } /* Reduced from 3.5rem */
            .text-6xl { font-size: 2.5rem; } /* Reduced from 3rem */
            .text-5xl { font-size: 2rem; } /* Reduced from 2.5rem */
            .text-4xl { font-size: 1.75rem; } /* Reduced from 2rem */
            .text-3xl { font-size: 1.5rem; } /* Reduced from 1.75rem */
            .text-2xl { font-size: 1.25rem; } /* Reduced from 1.5rem */
            .bento-grid {
                grid-template-columns: 1fr;
            }
            .bento-item {
                padding: 1.5rem;
            }
            /* Ensure text-left for mobile collapsible items */
            .text-left-mobile {
                text-align: left;
            }
        }

        /* Styles for interactive collapsible content */
        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
            opacity: 0;
            width: 100%;
        }

        .collapsible-content.expanded {
            max-height: 1000px; /* 足夠大的值以包含內容 */
            opacity: 1;
            padding-top: 1rem;
        }

        .collapsible-header .icon {
            transition: transform 0.3s ease-out;
        }

        .collapsible-header.expanded .icon {
            transform: rotate(90deg); /* 展開時旋轉圖示 */
        }

        /* Styles for the new dropdown and image area */
        .charger-select {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            color: #fff;
            font-size: 1.125rem;
            margin-bottom: 2rem;
            appearance: none; /* 移除默認下拉箭頭 */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
            cursor: pointer;
        }
        .charger-select option {
            background-color: #1a202c; /* 選項的深色背景 */
            color: #fff;
        }
        .charger-image {
            max-width: 100%; /* 響應式圖像大小，佔其容器的全部寬度 */
            height: auto;
            border-radius: 1rem;
            border: 2px solid rgba(52, 211, 153, 0.5);
            box-shadow: 0 0 20px rgba(52, 211, 153, 0.3);
            transition: transform 0.3s ease-out;
        }
        .charger-image:hover {
            transform: scale(1.02);
        }

        /* Adjust list item alignment within collapsible content */
        .collapsible-content ul {
            text-align: left; /* 確保列表項目左對齊 */
            margin-left: auto; /* 在較大螢幕上將列表置中 */
            margin-right: auto;
            max-width: 90%; /* 調整寬度以提高可讀性 */
        }

        /* Specific styles for the new flow chart */
        .flow-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 0.5rem; /* Reduced padding */
            border-radius: 9999px; /* Fully rounded */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            flex-shrink: 0;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem;
            min-width: 8rem; /* Smallest fixed width */
            max-width: 10rem; /* Max width to prevent overstretching */
            height: 8rem; /* Fixed height for consistency */
            md:min-width: 10rem;
            md:height: 10rem;
        }

        .flow-node i {
            font-size: 2.25rem; /* text-4xl */
            margin-bottom: 0.5rem;
        }

        .flow-text {
            font-size: 0.75rem; /* text-xs */
            line-height: 1rem;
            font-weight: 300; /* font-light */
            color: #d1d5db; /* gray-300 */
        }
        .flow-text-bold {
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem;
            font-weight: 700; /* font-bold */
            color: #fff; /* white */
        }

        /* Arrows styling */
        .flow-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1; /* Allows arrows to take available space */
            text-align: center;
            margin: 0 0.5rem; /* Adjust horizontal margin */
        }

        .flow-arrow i {
            font-size: 1.5rem; /* text-2xl */
            margin: 0.25rem 0; /* Vertical margin for arrows */
        }
        .flow-arrow span {
            font-size: 0.75rem; /* text-xs */
            line-height: 1rem;
            color: #cbd5e1; /* slate-300 */
            text-wrap: wrap; /* Allow text to wrap */
            max-width: 6rem; /* Limit width for text in arrows */
            padding: 0 0.25rem; /* Small horizontal padding */
        }

        /* Specific colors for flow nodes */
        .node-investor { background-color: #6d28d9; /* purple-700 */ }
        /* Removed .node-franchisee as it's no longer a distinct node */
        .node-star-charger { background-color: #1f2937; /* gray-800 */ border: 2px solid #34d399; /* emerald-400 */ }
        .node-charging-station { background-color: #06b6d4; /* cyan-600 */ }
        .node-ev-owner { background-color: #2563eb; /* blue-600 */ }

        /* Calculator specific styles */
        #page-revenue-calculator .bg-white {
            background-color: #fff;
            color: #000; /* Ensure text within calculator is dark on white background */
        }
        #page-revenue-calculator label {
            color: #374151; /* gray-700 */
        }
        #page-revenue-calculator .text-red-600 {
            color: #dc2626;
        }
        #page-revenue-calculator .text-green-600 {
            color: #16a34a;
        }
        #page-revenue-calculator .text-blue-700 {
            color: #1d4ed8;
        }
        #admin-details-section {
            display: none; /* Initially hidden */
        }
        #chart-container {
            margin-top: 2rem;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.8); /* Dark background for chart */
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0; /* Changed from display: none */
            pointer-events: none; /* Disable interaction when hidden */
            transition: opacity 0.5s ease-out; /* Smooth transition */
            height: 500px; /* Increased fixed height for the chart container */
        }
        #chart-container.visible {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-black text-white">

    <section id="page-title" class="full-page-section bg-gradient-to-br from-black to-gray-900">
        <div class="animate-on-scroll flex flex-col items-center justify-center">
            <h1 class="text-6xl md:text-7xl lg:text-8xl font-extrabold text-emerald-400 leading-tight mb-4 drop-shadow-lg">
                充電站(樁)投資加盟分析
            </h1>
            <p class="text-xl md:text-2xl lg:text-3xl text-gray-300 font-light tracking-wide">
                Charging Station (Pile) Investment and Franchise Analysis
            </p>
        </div>
    </section>

    <section id="page-summary" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-emerald">
            <h2 class="text-6xl md:text-7xl font-extrabold text-emerald-400 mb-8">總覽</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 bento-grid">
                <div class="bento-item col-span-1 highlight-gradient-cyan">
                    <i class="fas fa-car-battery text-5xl text-cyan-400 mb-4"></i>
                    <h3 class="text-3xl font-bold mb-2">電動車市場爆炸性成長</h3>
                    <p class="text-lg text-gray-200">全球與台灣電動車銷量均呈現強勁增長，政策支持與技術進步是主要驅動力。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-purple">
                    <i class="fas fa-charging-station text-5xl text-purple-400 mb-4"></i>
                    <h3 class="text-3xl font-bold mb-2">充電基礎設施需求迫切</h3>
                    <p class="text-lg text-gray-200">隨著電動車數量增加，充電樁缺口日益顯著，投資潛力巨大。</p>
                </div>
                <div class="bento-item col-span-full highlight-gradient-emerald">
                    <i class="fas fa-chart-line text-5xl text-emerald-400 mb-4"></i>
                    <h3 class="text-3xl font-bold mb-2">投資評估要點</h3>
                    <p class="text-lg text-gray-200">地點、設備、請電&建置成本、盈利模式、法規都是關鍵考量，加盟可大大降低投資門檻。</p>
                </div>
            </div>
        </div>
    </section>

    <section id="page-global-growth" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-cyan">
            <h2 class="text-6xl md:text-7xl font-extrabold text-cyan-400 mb-8">全球市場概況</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 bento-grid">
                <div class="bento-item col-span-1 highlight-gradient-emerald">
                    <div class="text-7xl font-extrabold text-emerald-400 mb-2 animated-number" data-target-value="1700" data-unit="萬">
                        <span class="current-value">0</span><span class="text-2xl md:text-3xl">萬</span>
                    </div>
                    <p class="text-xl text-gray-200">2024年全球電動車銷量/輛</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-purple">
                    <div class="text-7xl font-extrabold text-purple-400 mb-2">20%</div>
                    <p class="text-xl text-gray-200">電動車在全球市佔率</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-cyan">
                    <div class="text-7xl font-extrabold text-cyan-400 mb-2">26%</div>
                    <p class="text-xl text-gray-200">年增長率 (vs. 2023)</p>
                </div>
                <div class="bento-item col-span-full highlight-gradient-emerald">
                    <h3 class="text-4xl font-bold mb-4 text-emerald-400">主要因素</h3>
                    <ul class="list-disc list-inside w-full max-w-md mx-auto text-left">
                        <li>政府政策推動</li>
                        <li>嚴格燃油車排放標準</li>
                        <li>電池技術進步</li>
                        <li>消費者環保意識提升</li>
                        <li>更多車廠投入</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="page-taiwan-growth" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-purple">
            <h2 class="text-6xl md:text-7xl font-extrabold text-purple-400 mb-8">台灣市場現況</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 bento-grid">
                <div class="bento-item col-span-1 highlight-gradient-cyan">
                    <div class="text-7xl font-extrabold text-cyan-400 mb-2 animated-number" data-target-value="9.8" data-unit="萬">
                        <span class="current-value">0</span><span class="text-2xl md:text-3xl">萬</span>
                    </div>
                    <p class="text-xl text-gray-200">2024年台灣電動車掛牌數/輛</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-purple">
                    <div class="text-7xl font-extrabold text-purple-400 mb-2">8.3%</div>
                    <p class="text-xl text-gray-200">市場佔有率</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-emerald">
                    <div class="text-7xl font-extrabold text-emerald-400 mb-2">63.9%</div>
                    <p class="text-xl text-gray-200">年增長率 (vs. 2023)</p>
                </div>
                
                <div class="bento-item col-span-full highlight-gradient-cyan">
                    <h3 class="text-4xl font-bold mb-4 text-cyan-400">主要因素</h3>
                    <ul class="list-disc list-inside w-full max-w-md mx-auto text-left">
                        <li>國產電動車 n7 上市造成爆發性成長</li>
                        <li>Tesla 持續主導 + 價格調整策略</li>
                        <li>政府政策與補助支持</li>
                        <li>充電基礎設施逐步擴增</li>
                        <li>節能環保意識提升 + 燃油車成本升高</li>
                        <li>消費者選擇變多、接受度提高</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="page-investment-demand" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-emerald">
            <h2 class="text-6xl md:text-7xl font-extrabold text-emerald-400 mb-8">投資加盟可行性分析</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 bento-grid">
                <div class="bento-item col-span-1 highlight-gradient-cyan">
                    <i class="fas fa-map-marked-alt text-5xl text-cyan-400 mb-4"></i>
                    <h3 class="text-3xl font-bold mb-2">市場需求與潛力</h3>
                    <p class="text-lg text-gray-200">解決里程焦慮、公共充電樁缺口、多樣化場景需求。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-purple">
                    <i class="fas fa-handshake text-5xl text-purple-400 mb-4"></i>
                    <h3 class="text-3xl font-bold mb-2">投資模式</h3>
                    <p class="text-lg text-gray-200">自行建置與營運、加盟現有品牌、與場地主合作。</p>
                </div>
            </div>
        </div>
    </section>

    <section id="page-investment-factors" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-cyan">
            <h2 class="text-6xl md:text-7xl font-extrabold text-cyan-400 mb-8">投資考量因素</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 bento-grid">
                <div class="bento-item col-span-1 highlight-gradient-emerald">
                    <i class="fas fa-map-marker-alt text-4xl text-emerald-400 mb-2"></i>
                    <h4 class="text-2xl font-bold">地點選擇</h4>
                    <p class="text-md text-gray-200">車流量、電力容量、停車便利性、周邊設施。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-purple">
                    <i class="fas fa-tools text-4xl text-purple-400 mb-2"></i>
                    <h4 class="text-2xl font-bold">設備選擇</h4>
                    <p class="text-md text-gray-200">慢充/快充、充電規格、可靠性與維護。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-cyan">
                    <i class="fas fa-money-bill-wave text-4xl text-cyan-400 mb-2"></i>
                    <h4 class="text-2xl font-bold">營運成本</h4>
                    <p class="text-md text-gray-200">電費、維護費、租金、軟體平台費、保險。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-emerald">
                    <i class="fas fa-dollar-sign text-4xl text-emerald-400 mb-2"></i>
                    <h4 class="text-2xl font-bold">盈利模式</h4>
                    <p class="text-md text-gray-200">充電服務費、停車費、廣告收入、會員制。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-purple">
                    <i class="fas fa-balance-scale text-4xl text-purple-400 mb-2"></i>
                    <h4 class="text-2xl font-bold">政府補助與法規</h4>
                    <p class="text-md text-gray-200">建置補助、停車場法、電業法、消防安全。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-cyan">
                    <i class="fas fa-users text-4xl text-cyan-400 mb-2"></i>
                    <h4 class="text-2xl font-bold">競爭態勢與技術發展</h4>
                    <p class="text-md text-gray-200">周邊競爭、差異化、充電技術演進、智慧電網。</p>
                </div>
            </div>
        </div>
    </section>

    <section id="page-future-challenges" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-purple">
            <h2 class="text-6xl md:text-7xl font-extrabold text-purple-400 mb-8">未來展望與挑戰</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 bento-grid">
                <div class="bento-item col-span-1 highlight-gradient-emerald">
                    <i class="fas fa-lightbulb text-5xl text-emerald-400 mb-4"></i>
                    <h3 class="text-3xl font-bold mb-2">展望</h3>
                    <p class="text-lg text-gray-200">市場持續擴大、技術整合 (V2G)、服務多元化。</p>
                </div>
                <div class="bento-item col-span-1 highlight-gradient-cyan">
                    <i class="fas fa-exclamation-triangle text-5xl text-cyan-400 mb-4"></i>
                    <h3 class="text-3xl font-bold mb-2">挑戰</h3>
                    <p class="text-lg text-gray-200">電網負荷(是否有饋線?)、土地來源與取得成本、充電投資回報週期長、電動車量體成長率。</p>
                </div>
            </div>
        </div>
    </section>

    <section id="page-conclusion" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-emerald">
            <h2 class="text-6xl md:text-7xl font-extrabold text-emerald-400 mb-8">結論</h2>
            <div class="text-xl text-gray-200 leading-relaxed space-y-4">
                <p>充電樁市場受電動車成長帶動，在台灣仍具發展潛力。</p>
                <p>投資前應評估地點、成本、法規與同業競爭對手，加盟可降低門檻但須慎選品牌。</p>
                <p>投資具有前景的長期機會。</p>
                <p>持續關注政策與產業動向，並諮詢專業意見。</p>
            </div>
        </div>
    </section>

    <section id="page-actions" class="full-page-section bg-black min-h-screen">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-cyan">
            <h2 class="text-6xl md:text-7xl font-extrabold text-cyan-400 mb-8">充電投資評估五大重點</h2>

            <div class="bento-item highlight-gradient-emerald mb-8 text-left-mobile w-full">
                <div class="collapsible-header">
                    <div class="flex items-center">
                        <i class="fas fa-search-location text-5xl text-emerald-400 mr-4"></i>
                        <h3 class="text-3xl font-bold text-emerald-300">1. 地點評估</h3>
                    </div>
                    <i class="fas fa-chevron-right text-3xl text-gray-400 icon"></i>
                </div>
                <div class="collapsible-content">
                    <div class="space-y-4 text-lg text-gray-200 w-full px-4">
                        <p class="font-semibold text-emerald-300">篩選潛力區域：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>依據電動車熱區與常用路線及其數據評估所選場址。</li>
                        </ul>
                        <p class="font-semibold text-emerald-300">現場與電力評估：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>勘查車流、停車位，確認電力供應與快充可行性。</li>
                        </ul>
                        <p class="font-semibold text-emerald-300">競爭與周邊環境：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>了解周邊競爭情況，並評估餐飲、休息等加值服務。</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="bento-item highlight-gradient-purple mb-8 text-left-mobile w-full">
                <div class="collapsible-header">
                    <div class="flex items-center">
                        <i class="fas fa-handshake text-5xl text-purple-400 mr-4"></i>
                        <h3 class="text-3xl font-bold text-purple-300">2. 加盟品牌</h3>
                    </div>
                    <i class="fas fa-chevron-right text-3xl text-gray-400 icon"></i>
                </div>
                <div class="collapsible-content">
                    <div class="space-y-4 text-lg text-gray-200 w-full px-4">
                        <p class="font-semibold text-purple-300">品牌：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>星舟快充擁有完善的建置及軟體後台能力。</li>
                        </ul>
                        <p class="font-semibold text-purple-300">方案：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>評估加盟金、分潤、支援服務與合約條款。</li>
                        </ul>
                        <p class="font-semibold text-purple-300">評價：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>比較市占率、App 操作體驗、車主評價。</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="bento-item highlight-gradient-cyan mb-8 text-left-mobile w-full">
                <div class="collapsible-header">
                    <div class="flex items-center">
                        <i class="fas fa-calculator text-5xl text-cyan-400 mr-4"></i>
                        <h3 class="text-3xl font-bold text-cyan-300">3. 財務模型建構</h3>
                    </div>
                    <i class="fas fa-chevron-right text-3xl text-gray-400 icon"></i>
                </div>
                <div class="collapsible-content">
                    <div class="space-y-4 text-lg text-gray-200 w-full px-4">
                        <p class="font-semibold text-cyan-300">成本預算：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>列出初期設備與營運成本。</li>
                        </ul>
                        <p class="font-semibold text-cyan-300">收入來源：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>包括充電費、廣告、停車與會員制。</li>
                        </ul>
                        <p class="font-semibold text-cyan-300">財務指標：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>計算損益平衡點、回收期、IRR、NPV，進行敏感度分析。</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="bento-item highlight-gradient-emerald mb-8 text-left-mobile w-full">
                <div class="collapsible-header">
                    <div class="flex items-center">
                        <i class="fas fa-gavel text-5xl text-emerald-400 mr-4"></i>
                        <h3 class="text-3xl font-bold text-emerald-300">4. 法規與補助</h3>
                    </div>
                    <i class="fas fa-chevron-right text-3xl text-gray-400 icon"></i>
                </div>
                <div class="collapsible-content">
                    <div class="space-y-4 text-lg text-gray-200 w-full px-4">
                        <p class="font-semibold text-emerald-300">中央政策：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>符合能源署與經濟部補助及規範（如《電業法》、《停車場法》）。</li>
                        </ul>
                        <p class="font-semibold text-emerald-300">地方政府：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>確認建築法規、消防、土地使用等。</li>
                        </ul>
                        <p class="font-semibold text-emerald-300">消防規範：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>消防相關，規劃應變方案。</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="bento-item highlight-gradient-purple mb-8 text-left-mobile w-full">
                <div class="collapsible-header">
                    <div class="flex items-center">
                        <i class="fas fa-users-cog text-5xl text-purple-400 mr-4"></i>
                        <h3 class="text-3xl font-bold text-purple-300">5. 專業顧問協助</h3>
                    </div>
                    <i class="fas fa-chevron-right text-3xl text-gray-400 icon"></i>
                </div>
                <div class="collapsible-content">
                    <div class="space-y-4 text-lg text-gray-200 w-full px-4">
                        <p class="font-semibold text-purple-300">產業資訊：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>提供產業趨勢與技術建議。</li>
                        </ul>
                        <p class="font-semibold text-purple-300">合約相關：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>審閱合約、處理法遵事務。</li>
                        </ul>
                        <p class="font-semibold text-purple-300">財務相關：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>確立財務(金流相關)與稅務。</li>
                        </ul>
                        <p class="font-semibold text-purple-300">電機/工程顧問：</p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>設計與審核電力系統(請電)與工程安全。</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="page-charger-diagrams" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-cyan">
            <h2 class="text-6xl md:text-7xl font-extrabold text-cyan-400 mb-8">充電樁設備簡介</h2>
            <div class="flex flex-col items-center w-full max-w-4xl mx-auto">
                <label for="charger-type" class="text-2xl font-bold mb-4 text-gray-200">選擇充電樁功率:</label>
                <select id="charger-type" class="charger-select w-full md:w-3/4">
                    <option value="7kW">7kW</option>
                    <option value="30kW">30kW</option>
                    <option value="120kW">120kW</option>
                    <option value="180kW">180kW</option>
                    <option value="360kW">360kW</option>
                </select>
                <div class="mt-8 w-full flex justify-center">
                    <img id="charger-image" src="https://i.meee.com.tw/lImWom7.jpg" alt="7kW 充電樁設備圖" class="charger-image">
                </div>
            </div>
        </div>
    </section>

    <section id="page-franchise-flow" class="full-page-section bg-black">
        <div class="animate-on-scroll max-w-6xl mx-auto p-8 rounded-3xl highlight-gradient-purple">
            <h2 class="text-6xl md:text-7xl font-extrabold text-purple-400 mb-8">加盟方案流程</h2>

            <div class="flex flex-col md:flex-row items-center justify-center w-full max-w-full mx-auto space-y-4 md:space-y-0 md:space-x-2">

                <div class="flow-node node-investor">
                    <i class="fas fa-building text-purple-200"></i>
                    <p class="flow-text-bold text-purple-200">投資方</p>
                    <p class="flow-text text-purple-200">(地主/企業/社區)</p>
                </div>

                <div class="flow-arrow text-yellow-500">
                    <span class="text-yellow-300">資金與場地</span>
                    <i class="fas fa-arrow-right"></i>
                    <i class="fas fa-arrow-left"></i>
                    <span class="text-yellow-300">營收與服務回饋</span>
                </div>

                <div class="flow-node node-star-charger">
                    <p class="flow-text-bold text-emerald-400">星舟快充</p>
                    <p class="flow-text text-gray-400">STAR CHARGER</p>
                    <p class="flow-text text-gray-500 mt-1">（含認證廠商與平台）</p> </div>

                <div class="flow-arrow text-blue-400">
                    <span class="text-blue-300">規劃、建置與維護</span>
                    <i class="fas fa-arrow-right"></i>
                </div>

                <div class="flow-node node-charging-station">
                    <i class="fas fa-charging-station text-cyan-200"></i>
                    <p class="flow-text-bold text-cyan-200">充電站</p>
                </div>

                <div class="flow-arrow text-green-400">
                    <span class="text-green-300">提供充電服務</span>
                    <i class="fas fa-arrow-right"></i>
                    <i class="fas fa-arrow-left"></i>
                    <span class="text-green-300">支付充電費用</span>
                </div>

                <div class="flow-node node-ev-owner">
                    <i class="fas fa-car-side text-blue-200"></i>
                    <p class="flow-text-bold text-blue-200">充電車主</p>
                </div>
            </div>

            <div class="mt-12 text-center text-gray-400 text-sm space-y-2">
                <p>此流程圖概括了星舟快充生態系的運作模式，以及加盟方案的主要互動關係：</p>
                <ul class="list-disc list-inside mx-auto max-w-3xl text-left">
                    <li><strong class="text-purple-400">投資方 (地主/企業/社區)</strong> 提供**資金與場地**給<strong class="text-emerald-400">星舟快充 (含認證廠商與平台)</strong>，並從星舟快充處獲得**營收與服務回饋**。</li>
                    <li><strong class="text-emerald-400">星舟快充 (含認證廠商與平台)</strong> 負責<strong class="text-cyan-400">充電站</strong>的**規劃、建置與維護**。</li>
                    <li><strong class="text-cyan-400">充電站</strong>向<strong class="text-blue-400">充電車主</strong>**提供充電服務**。</li>
                    <li><strong class="text-blue-400">充電車主**支付**充電費用**給<strong class="text-cyan-400">充電站**。</li>
                    <li>整個系統形成一個資金與服務的良性循環，推動永續營運與充電網絡擴張。</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Page: Charging Station Revenue Estimation Calculator -->
    <section id="page-revenue-calculator" class="full-page-section bg-black">
        <div class="animate-on-scroll bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl"> <!-- Changed max-w-md to max-w-3xl -->
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">充電站營收預估試算</h2>

            <!-- 充電功率 (保留在頂部) -->
            <div class="mb-4">
                <label for="calc-powerConsumption" class="block text-gray-700 text-sm font-medium mb-2">充電功率（kW）：</label>
                <select id="calc-powerConsumption" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800">
                    <option value="7">7 kW</option>
                    <option value="30" selected>30 kW</option>
                    <option value="120">120 kW</option>
                    <option value="180">180 kW</option>
                    <option value="360">360 kW</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="calc-slots" class="block text-gray-700 text-sm font-medium mb-2">車格數 / 格：</label>
                <input type="number" id="calc-slots" value="2" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
            </div>

            <div class="mb-4">
                <label for="calc-years" class="block text-gray-700 text-sm font-medium mb-2">營運年期（年）：</label>
                <input type="number" id="calc-years" value="10" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
            </div>

            <button onclick="calculateRevenue()" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300 ease-in-out shadow-md">
                計算預估營收
            </button>

            <div id="calc-result" class="mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200 text-gray-800 text-lg leading-relaxed hidden">
                <!-- 結果將顯示在這裡 -->
            </div>

            <!-- Chart Container -->
            <div id="chart-container" class="w-full" style="height: 500px;"> <!-- Increased height for the chart container -->
                <canvas id="revenueChart"></canvas>
            </div>

            <hr class="my-6 border-gray-300" />

            <h4 class="text-xl font-bold text-gray-800 mb-4 text-center">🔐 管理員登入</h4>
            <div class="mb-4">
                <label for="adminPass" class="block text-gray-700 text-sm font-medium mb-2">輸入管理密碼：</label>
                <input type="password" id="adminPass" placeholder="輸入密碼" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
            </div>
            <button onclick="loginAdmin()" class="w-full bg-green-600 text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition duration-300 ease-in-out shadow-md">
                登入
            </button>
            <p id="login-status" class="mt-3 text-sm text-center"></p>

            <div id="admin-details-section" class="mt-8 p-6 bg-yellow-50 rounded-lg border border-yellow-200 text-gray-800 text-sm leading-relaxed">
                <h4 class="text-lg font-bold text-gray-700 mb-3">管理員模式 - 詳細計算公式與參數設定</h4>

                <!-- 移入管理員模式的輸入欄位 -->
                <div class="mb-4">
                    <label for="calc-dailyVehicleCountPerSlot" class="block text-gray-700 text-sm font-medium mb-2">每日車次 / 格：</label>
                    <input type="number" id="calc-dailyVehicleCountPerSlot" value="5" min="1" step="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
                </div>

                <div class="mb-4">
                    <label for="calc-averageKWHPerVehicleCharge" class="block text-gray-700 text-sm font-medium mb-2">每車平均充電度數（度/次）：</label>
                    <input type="number" id="calc-averageKWHPerVehicleCharge" value="30" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
                </div>

                <div class="mb-4">
                    <label for="calc-chargingRate" class="block text-gray-700 text-sm font-medium mb-2">每度電費率（NTD/度）：</label>
                    <input type="number" id="calc-chargingRate" value="9" min="0.1" step="0.1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
                </div>

                <div class="mb-4">
                    <label for="calc-electricityCost" class="block text-gray-700 text-sm font-medium mb-2">台電成本（NTD/度）：</label>
                    <input type="number" id="calc-electricityCost" value="4.0" min="0" step="0.1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
                </div>

                <!-- 新增電動車充電年增率輸入欄位 -->
                <div class="mb-4">
                    <label for="calc-annualGrowthRate" class="block text-gray-700 text-sm font-medium mb-2">電動車充電年增率（%）：</label>
                    <input type="number" id="calc-annualGrowthRate" value="10" min="0" step="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
                </div>

                <!-- 新增投資成本輸入欄位 -->
                <div class="mb-6">
                    <label for="calc-investmentCostPerKW" class="block text-gray-700 text-sm font-medium mb-2">每 KW 投資成本（NTD/kW）：</label>
                    <input type="number" id="calc-investmentCostPerKW" value="12000" min="0" step="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-800" />
                </div>

                <h5 class="text-md font-bold text-gray-700 mb-2 mt-4">計算細項：</h5>
                <p><strong>台電成本：</strong> <span id="admin-electricity-cost"></span> NTD/度</p>
                <p><strong>每度電淨利潤：：</strong> <span id="admin-net-profit"></span> NTD/度 (計算：費率 - 電成本)</p>
                <p><strong>每日總充電度數 / 格：：</strong> <span id="admin-daily-kwh-per-slot"></span> 度/格 (計算：每日車次/格 × 每車平均充電度數)</p>
                <p><strong>每個車格每日淨營收：：</strong> <span id="admin-daily-net-revenue-per-slot"></span> NTD/格 (計算：每日總充電度數/格 × 每度電淨利潤)</p>
                <p><strong>總每日淨營收：：</strong> <span id="admin-total-daily-net-revenue"></span> NTD (計算：每個車格每日淨營收 × 車格數)</p>
                <p><strong>總每年淨營收 (第一年)：：</strong> <span id="admin-total-annual-net-revenue"></span> NTD (計算：總每日淨營收 × 365天)</p>
                <p><strong>總營運年期淨營收：：</strong> <span id="admin-total-projected-revenue"></span> NTD (計算：總每年淨營收 × 營運年期，考慮年增率)</p>
                <p class="mt-4"><strong>總投資成本金額：：</strong> <span id="admin-total-investment-cost"></span> NTD</p>
                <p class="text-xs text-gray-600">
                    (計算：<span id="admin-investment-formula"></span>)
                </p>
            </div>
        </div>
    </section>

    <script>
        let isAdmin = false; // 管理員登入狀態
        let revenueChartInstance = null; // 用於儲存 Chart.js 實例

        // Register Chart.js DataLabels plugin globally
        Chart.register(ChartDataLabels);

        /**
         * 載入管理員參數預設值或儲存的值。
         * 從 localStorage 讀取值，如果沒有則使用 HTML 中設定的預設值。
         */
        function loadAdminParameters() {
            // Define default values if not in localStorage or initial HTML
            const defaultValues = {
                dailyVehicleCount: 5,
                averageKWH: 30,
                chargingRate: 9,
                electricityCost: 4.0,
                annualGrowthRate: 10, // 新增年增率預設值
                investmentCostPerKW: 12000
            };

            // 使用與 HTML ID 匹配的鍵名
            document.getElementById('calc-dailyVehicleCountPerSlot').value = localStorage.getItem('calc-dailyVehicleCountPerSlot') || defaultValues.dailyVehicleCount;
            document.getElementById('calc-averageKWHPerVehicleCharge').value = localStorage.getItem('calc-averageKWHPerVehicleCharge') || defaultValues.averageKWH;
            document.getElementById('calc-chargingRate').value = localStorage.getItem('calc-chargingRate') || defaultValues.chargingRate;
            document.getElementById('calc-electricityCost').value = localStorage.getItem('calc-electricityCost') || defaultValues.electricityCost;
            document.getElementById('calc-annualGrowthRate').value = localStorage.getItem('calc-annualGrowthRate') || defaultValues.annualGrowthRate; // 載入年增率
            document.getElementById('calc-investmentCostPerKW').value = localStorage.getItem('calc-investmentCostPerKW') || defaultValues.investmentCostPerKW;
        }

        /**
         * 儲存管理員參數值到 localStorage。
         */
        function saveAdminParameters() {
            // 使用與 HTML ID 匹配的鍵名
            localStorage.setItem('calc-dailyVehicleCountPerSlot', document.getElementById('calc-dailyVehicleCountPerSlot').value);
            localStorage.setItem('calc-averageKWHPerVehicleCharge', document.getElementById('calc-averageKWHPerVehicleCharge').value);
            localStorage.setItem('calc-chargingRate', document.getElementById('calc-chargingRate').value);
            localStorage.setItem('calc-electricityCost', document.getElementById('calc-electricityCost').value);
            localStorage.setItem('calc-annualGrowthRate', document.getElementById('calc-annualGrowthRate').value); // 儲存年增率
            localStorage.setItem('calc-investmentCostPerKW', document.getElementById('calc-investmentCostPerKW').value);
        }

        /**
         * 根據管理員狀態設定輸入欄位的啟用/禁用狀態和視覺效果。
         */
        function setAdminInputStates() {
            const adminInputs = [
                document.getElementById('calc-dailyVehicleCountPerSlot'),
                document.getElementById('calc-averageKWHPerVehicleCharge'),
                document.getElementById('calc-chargingRate'),
                document.getElementById('calc-electricityCost'),
                document.getElementById('calc-annualGrowthRate'), // 新增年增率到管理員輸入列表
                document.getElementById('calc-investmentCostPerKW')
            ];

            adminInputs.forEach(input => {
                input.disabled = !isAdmin;
                if (isAdmin) {
                    input.classList.remove('bg-gray-200');
                    input.classList.add('focus:ring-blue-500');
                } else {
                    input.classList.add('bg-gray-200');
                    input.classList.remove('focus:ring-blue-500');
                }
            });

            // Specific logic for chargingRate and dailyVehicleCountPerSlot
            updateChargingRateBasedOnPower();
            updateDailyVehicleCountBasedOnPower();
        }

        /**
         * 執行充電站營收預估計算。
         * 根據輸入的車格數、營運年期、每日車次/格、每車平均充電度數、充電功率、每度電費率和台電成本，
         * 計算每日、每年及總營運期間的預估淨營收。並加入投資成本的計算。
         */
        window.calculateRevenue = function() {
            console.log("calculateRevenue called.");
            // 獲取使用者輸入的值 (來自公共區塊和管理員區塊)
            const slots = parseInt(document.getElementById('calc-slots').value);
            const years = parseInt(document.getElementById('calc-years').value);
            const dailyVehicleCountPerSlot = parseInt(document.getElementById('calc-dailyVehicleCountPerSlot').value);
            const averageKWHPerVehicleCharge = parseInt(document.getElementById('calc-averageKWHPerVehicleCharge').value);
            const chargingRatePerKWH = parseFloat(document.getElementById('calc-chargingRate').value);
            const electricityCostPerKWH = parseFloat(document.getElementById('calc-electricityCost').value);
            const annualGrowthRate = parseFloat(document.getElementById('calc-annualGrowthRate').value) / 100; // 轉換為小數
            const investmentCostPerKW = parseFloat(document.getElementById('calc-investmentCostPerKW').value);

            const averagePowerConsumptionKW = parseFloat(document.getElementById('calc-powerConsumption').value);

            const resultDiv = document.getElementById('calc-result');
            const adminDetailsSection = document.getElementById('admin-details-section');
            const chartContainer = document.getElementById('chart-container');

            // 驗證輸入是否為有效數字且大於0 (成本可以為0)
            if (isNaN(slots) || slots <= 0 ||
                isNaN(years) || years <= 0 ||
                isNaN(dailyVehicleCountPerSlot) || dailyVehicleCountPerSlot <= 0 ||
                isNaN(averageKWHPerVehicleCharge) || averageKWHPerVehicleCharge <= 0 ||
                isNaN(chargingRatePerKWH) || chargingRatePerKWH <= 0 ||
                isNaN(electricityCostPerKWH) || electricityCostPerKWH < 0 ||
                isNaN(annualGrowthRate) || annualGrowthRate < 0 || // 年增率可以為0
                isNaN(investmentCostPerKW) || investmentCostPerKW < 0)
            {
                resultDiv.innerHTML = '<p class="text-red-600 font-semibold">請輸入有效的數值 (所有欄位除了台電成本和投資成本，其餘必須為正數)。</p>';
                resultDiv.classList.remove('hidden');
                chartContainer.classList.remove('visible'); // Hide chart on error
                if (isAdmin) adminDetailsSection.style.display = 'block'; // 保持顯示管理員詳情以便修改錯誤
                console.log("Input validation failed.");
                return;
            }

            // 驗證車格數限制：30kW 以上的功率，車格數必須是偶數且至少為 2
            if (averagePowerConsumptionKW > 30) {
                if (slots < 2 || slots % 2 !== 0) {
                    resultDiv.innerHTML = '<p class="text-red-600 font-semibold">錯誤：當充電功率為 30kW 以上時，車格數必須是偶數且至少為 2 格。</p>';
                    resultDiv.classList.remove('hidden');
                    chartContainer.classList.remove('visible'); // Hide chart on error
                    if (isAdmin) adminDetailsSection.style.display = 'block'; // 保持顯示管理員詳情以便修改錯誤
                    console.log("Slot count validation failed for high power.");
                    return;
                }
            }

            // 定義預估計算所需的常數
            const operationDaysPerYear = 365;

            // 步驟 1: 計算每度電的淨利潤
            const netProfitPerKWH = chargingRatePerKWH - electricityCostPerKWH;

            // 如果淨利潤為負，顯示警告
            if (netProfitPerKWH < 0) {
                resultDiv.innerHTML = '<p class="text-red-600 font-semibold">警告：您的每度電費率低於台電成本，將導致虧損！</p>';
                resultDiv.classList.remove('hidden');
                chartContainer.classList.remove('visible'); // Hide chart on error
                if (isAdmin) adminDetailsSection.style.display = 'block'; // 保持顯示管理員詳情以便修改錯誤
                console.log("Negative net profit warning.");
                return;
            }

            // 步驟 2: 計算每個車格每日的總充電度數
            const totalDailyKWHPerSlot = dailyVehicleCountPerSlot * averageKWHPerVehicleCharge;

            // 步驟 3: 計算每個車格每日的淨營收
            const dailyNetRevenuePerSlot = totalDailyKWHPerSlot * netProfitPerKWH;

            // 步驟 4: 計算總每日淨營收 (所有車格)
            let initialTotalDailyNetRevenue = dailyNetRevenuePerSlot * slots;

            // 步驟 5: 計算總每年淨營收 (第一年)
            let initialTotalAnnualNetRevenue = initialTotalDailyNetRevenue * operationDaysPerYear;

            // 步驟 6: 計算總營運期間的預估淨營收 (考慮年增率)
            let totalProjectedRevenue = 0;
            const annualRevenuesForChart = []; // For cumulative revenue
            const annualNetRevenuesPerYearForChart = []; // For annual revenue line

            let currentAnnualRevenue = initialTotalAnnualNetRevenue;
            for (let i = 0; i < years; i++) {
                if (i > 0) {
                    currentAnnualRevenue *= (1 + annualGrowthRate);
                }
                totalProjectedRevenue += currentAnnualRevenue;
                annualRevenuesForChart.push(totalProjectedRevenue); // Cumulative
                annualNetRevenuesPerYearForChart.push(currentAnnualRevenue); // Annual for line
            }

            // 步驟 7: 計算投資成本金額
            let totalInvestmentCost = 0;
            let investmentFormulaText = "";

            if (averagePowerConsumptionKW <= 30) { // 7kW 或 30kW
                totalInvestmentCost = averagePowerConsumptionKW * slots * investmentCostPerKW;
                investmentFormulaText = `${averagePowerConsumptionKW} kW × ${slots} 格 × ${investmentCostPerKW} NTD/kW`;
            } else { // 120kW, 180kW, 360kW
                totalInvestmentCost = averagePowerConsumptionKW * (slots / 2) * investmentCostPerKW;
                investmentFormulaText = `${averagePowerConsumptionKW} kW × (${slots} 格 / 2) × ${investmentCostPerKW} NTD/kW`;
            }

            // 儲存最新的管理員參數值 (只有在所有驗證通過後才儲存)
            saveAdminParameters();

            // Helper function to format currency based on value (for display in resultDiv)
            function formatCurrencyForDisplay(value) {
                // Round to nearest integer before checking magnitude
                const roundedValue = Math.round(value);
                if (Math.abs(roundedValue) >= 10000) { // If absolute value is 10,000 or more, display in 萬元
                    return `${(roundedValue / 10000).toLocaleString('zh-TW', { maximumFractionDigits: 0 })} 萬元`;
                } else { // Otherwise, display in 元
                    return `${roundedValue.toLocaleString('zh-TW')} 元`;
                }
            }

            // 將計算結果顯示在頁面上
            resultDiv.innerHTML = `
                <p><strong class="text-blue-700">投資成本(預估)：</strong> ${formatCurrencyForDisplay(totalInvestmentCost)}</p>
                <p><strong class="text-blue-700">每日營收(預估)：</strong> ${formatCurrencyForDisplay(initialTotalDailyNetRevenue)}</p>
                <p><strong class="text-blue-700">每年營收(預估 - 第一年)：</strong> ${formatCurrencyForDisplay(initialTotalAnnualNetRevenue)}</p>
                <p><strong class="text-blue-700">營運年期總營收(預估)：</strong> ${formatCurrencyForDisplay(totalProjectedRevenue)}</p>
                <p class="mt-4 text-sm text-gray-600">
                    ※ 備註：此為預估值，實際營收會因使用率、其他營運成本、折舊等因素影響。
                    本計算假設每車格每日充電車次為 <strong class="text-blue-700">${dailyVehicleCountPerSlot}</strong> 次，
                    每次平均充電 <strong class="text-blue-700">${averageKWHPerVehicleCharge}</strong> 度，
                    充電功率為 <strong class="text-blue-700">${averagePowerConsumptionKW}</strong> kW。
                    每度電費率 <strong class="text-blue-700">${chargingRatePerKWH}</strong> NTD，台電成本 <strong class="text-blue-700">${electricityCostPerKWH}</strong> NTD。
                    電動車充電年增率為 <strong class="text-blue-700">${(annualGrowthRate * 100).toFixed(0)}</strong>%。
                    <br>
                    <span class="font-bold">重要提示：依據過往加盟績效進行預估，不保證方案之最低收益，亦不代表未來績效之保證。</span>
                </p>
            `;
            resultDiv.classList.remove('hidden'); // 顯示結果區塊

            chartContainer.classList.add('visible'); // Show chart container by adding 'visible' class
            // Defer chart drawing slightly to ensure canvas has rendered with dimensions
            console.log("Calling drawRevenueChart with delay...");
            setTimeout(() => {
                // Pass both cumulative and annual data for charting
                drawRevenueChart(annualRevenuesForChart, years, annualNetRevenuesPerYearForChart);
            }, 200); // Increased delay to 200ms

            // 如果是管理員模式，顯示詳細計算公式
            if (isAdmin) {
                document.getElementById('admin-electricity-cost').textContent = electricityCostPerKWH.toFixed(1);
                document.getElementById('admin-net-profit').textContent = netProfitPerKWH.toFixed(2);
                document.getElementById('admin-daily-kwh-per-slot').textContent = totalDailyKWHPerSlot.toFixed(0);
                document.getElementById('admin-daily-net-revenue-per-slot').textContent = dailyNetRevenuePerSlot.toFixed(2);
                document.getElementById('admin-total-daily-net-revenue').textContent = initialTotalDailyNetRevenue.toFixed(2);
                document.getElementById('admin-total-annual-net-revenue').textContent = initialTotalAnnualNetRevenue.toFixed(2);
                document.getElementById('admin-total-projected-revenue').textContent = totalProjectedRevenue.toFixed(2);
                document.getElementById('admin-total-investment-cost').textContent = totalInvestmentCost.toFixed(2);
                document.getElementById('admin-investment-formula').textContent = investmentFormulaText; // 顯示投資成本公式
                adminDetailsSection.style.display = 'block'; // 顯示管理員詳情
            } else {
                adminDetailsSection.style.display = 'none'; // 非管理員隱藏
            }
        }

        /**
         * 繪製營收成長柱狀圖。
         * @param {Array<number>} cumulativeRevenues - 每年累積的淨營收 (單位元)。
         * @param {number} years - 營運年期。
         * @param {Array<number>} annualNetRevenuesPerYear - 每年淨營收的陣列 (單位元)。
         */
        function drawRevenueChart(cumulativeRevenues, years, annualNetRevenuesPerYear) {
            console.log("drawRevenueChart started.");
            const canvas = document.getElementById('revenueChart');
            if (!canvas) {
                console.error("Canvas element 'revenueChart' not found.");
                return;
            }
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error("Failed to get 2D context for canvas.");
                return;
            }
            console.log("Canvas and context obtained. Drawing chart with data:", cumulativeRevenues, "years:", years, "annual data:", annualNetRevenuesPerYear);


            // 如果已有圖表實例，先銷毀它
            if (revenueChartInstance) {
                revenueChartInstance.destroy();
                console.log("Existing chart instance destroyed.");
            }

            const labels = [];
            const annualRevenueDataForChart = annualNetRevenuesPerYear.map(val => Math.round(val / 10000)); // Convert annual revenue to 萬元 and round
            
            for (let i = 1; i <= years; i++) {
                labels.push(`第 ${i} 年`);
            }

            revenueChartInstance = new Chart(ctx, {
                type: 'bar', // 柱狀圖
                data: {
                    labels: labels,
                    datasets: [{
                        label: '累積淨營收 (萬元)',
                        data: cumulativeRevenues.map(val => Math.round(val / 10000)), // Convert cumulative to 萬元 and round
                        backgroundColor: 'rgba(52, 211, 153, 0.8)', // Emerald green for bars
                        borderColor: 'rgba(52, 211, 153, 1)',
                        borderWidth: 1,
                        borderRadius: 5, // Rounded corners for bars
                    },
                    {
                        type: 'line', // Line chart for annual revenue
                        label: '每年淨營收趨勢 (萬元)', // Updated label for clarity
                        data: annualRevenueDataForChart,
                        borderColor: 'rgba(6, 182, 212, 1)', // Cyan for annual line
                        backgroundColor: 'rgba(6, 182, 212, 0.2)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1, // Smooth the line
                        pointRadius: 5, // Show points on the line
                        pointHoverRadius: 7,
                        datalabels: {
                            display: false // Disable datalabels on the line itself
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '營收成長(預估)', // Updated title
                            color: '#e2e8f0', // Gray-200 for title
                            font: {
                                size: 18,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            labels: {
                                color: '#cbd5e1', // Slate-300 for legend text
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        // Format to integer and add 萬元
                                        label += `${Math.round(context.parsed.y).toLocaleString('zh-TW')} 萬元`;
                                    }
                                    return label;
                                }
                            }
                        },
                        datalabels: { // Global datalabels configuration (for bars, if any)
                            display: false, // Disable datalabels for bars by default
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '營運年期',
                                color: '#94a3b8', // Slate-400
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)', // Lighter grid lines
                            },
                            ticks: {
                                color: '#cbd5e1', // Slate-300 for x-axis labels
                                callback: function(value, index, ticks) {
                                    const yearLabel = `第 ${index + 1} 年`;
                                    // Ensure annualNetRevenue is in 萬元 and rounded for display
                                    const annualValueWan = annualRevenueDataForChart[index]; // Use the already converted annual data
                                    return [yearLabel, `${annualValueWan.toLocaleString('zh-TW')} 萬元`];
                                },
                                autoSkip: false, // Prevent ticks from being skipped
                                maxRotation: 0, // Prevent rotation
                                minRotation: 0,
                                padding: 10 // Add padding between labels and the axis line
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '金額 (萬元)', // Updated Y-axis title
                                color: '#94a3b8', // Slate-400
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)', // Lighter grid lines
                            },
                            ticks: {
                                color: '#cbd5e1', // Slate-300 for y-axis labels
                                callback: function(value) {
                                    // Format to integer for y-axis ticks
                                    return Math.round(value).toLocaleString('zh-TW');
                                }
                            }
                        }
                    }
                }
            });
            console.log("Chart instance created.");
        }

        /**
         * 處理管理員登入。
         * 如果密碼正確，則啟用管理員模式並顯示詳細計算區塊。
         */
        window.loginAdmin = function() { // Made global
            console.log("loginAdmin called.");
            const pass = document.getElementById("adminPass").value;
            const loginStatus = document.getElementById("login-status");
            const adminDetailsSection = document.getElementById('admin-details-section');
            const resultDiv = document.getElementById('calc-result'); // Get result div
            const chartContainer = document.getElementById('chart-container'); // Get chart container

            if (pass === "1688") { // 管理密碼
                isAdmin = true;
                loginStatus.textContent = "✅ 已成功登入管理員模式";
                loginStatus.classList.remove('text-red-600');
                loginStatus.classList.add('text-green-600');
                // 登入後立即更新計算結果，以顯示管理員詳細信息
                calculateRevenue(); // 使用更新後的 calculateRevenue 函數
                setAdminInputStates(); // 更新輸入欄位狀態
                adminDetailsSection.style.display = 'block'; // 確保管理員區塊在登入時可見
                console.log("Admin login successful.");
            } else {
                isAdmin = false;
                loginStatus.textContent = "❌ 密碼錯誤";
                loginStatus.classList.remove('text-green-600');
                loginStatus.classList.add('text-red-600');
                adminDetailsSection.style.display = 'none'; // 密碼錯誤時隱藏管理員詳情
                resultDiv.classList.add('hidden'); // 密碼錯誤時隱藏結果區塊
                chartContainer.classList.remove('visible'); // 密碼錯誤時隱藏圖表
                setAdminInputStates(); // 更新輸入欄位狀態
                console.log("Admin login failed.");
            }
        }

        /**
         * 根據充電功率的選擇更新每度電費率的輸入狀態和值。
         * 如果充電功率是7kW，則設定費率為8元並禁用輸入；
         * 否則，啟用輸入。
         */
        function updateChargingRateBasedOnPower() {
            const powerConsumptionSelect = document.getElementById('calc-powerConsumption');
            const chargingRateInput = document.getElementById('calc-chargingRate');
            
            const selectedPower = parseFloat(powerConsumptionSelect.value);
            if (selectedPower === 7) {
                chargingRateInput.value = 8;
                chargingRateInput.disabled = true; // Always disabled for 7kW, even for admin
                chargingRateInput.classList.add('bg-gray-200'); // 增加禁用時的視覺效果
                chargingRateInput.classList.remove('focus:ring-blue-500');
            } else {
                chargingRateInput.disabled = !isAdmin; // Disabled if not admin
                if (isAdmin) {
                    chargingRateInput.classList.remove('bg-gray-200');
                    chargingRateInput.classList.add('focus:ring-blue-500');
                } else {
                    chargingRateInput.classList.add('bg-gray-200');
                    chargingRateInput.classList.remove('focus:ring-blue-500');
                }
            }
            // Do NOT call calculateRevenue here to avoid double-triggers from other updates,
            // calculateRevenue will be called by the main DOMContentLoaded or other input changes.
        }

        /**
         * 根據充電功率的選擇更新每日車次/格的輸入狀態和值。
         * 如果充電功率是7kW，則設定為1並禁用輸入；
         * 否則，啟用輸入並設定為預設值5。
         */
        function updateDailyVehicleCountBasedOnPower() {
            const powerConsumptionSelect = document.getElementById('calc-powerConsumption');
            const dailyVehicleCountPerSlotInput = document.getElementById('calc-dailyVehicleCountPerSlot');

            const selectedPower = parseFloat(powerConsumptionSelect.value);
            if (selectedPower === 7) { // 只有當充電功率是7kW時固定為1車
                dailyVehicleCountPerSlotInput.value = 1;
                dailyVehicleCountPerSlotInput.disabled = true; // Always disabled for 7kW, even for admin
                dailyVehicleCountPerSlotInput.classList.add('bg-gray-200');
                dailyVehicleCountPerSlotInput.classList.remove('focus:ring-blue-500');
            } else {
                dailyVehicleCountPerSlotInput.disabled = !isAdmin; // Disabled if not admin
                if (dailyVehicleCountPerSlotInput.disabled && dailyVehicleCountPerSlotInput.value == 1) { // If it was fixed to 1 due to 7KW, reset it
                   dailyVehicleCountPerSlotInput.value = 5; // Restore initial default value
                }
                if (isAdmin) {
                    dailyVehicleCountPerSlotInput.classList.remove('bg-gray-200');
                    dailyVehicleCountPerSlotInput.classList.add('focus:ring-blue-500');
                } else {
                    dailyVehicleCountPerSlotInput.classList.add('bg-gray-200');
                    dailyVehicleCountPerSlotInput.classList.remove('focus:ring-blue-500');
                }
            }
            // Do NOT call calculateRevenue here
        }

        /**
         * 根據充電功率的選擇更新車格數的最小值和預設值，並強制為偶數（若功率大於30kW）。
         * 30kW 以上的功率一定是以2格為基礎，不會有單格數，且必須是偶數。
         * 30kW 跟 7kW 可以單格數。
         */
        function updateSlotsMinAndValue() {
            const powerConsumptionSelect = document.getElementById('calc-powerConsumption');
            const slotsInput = document.getElementById('calc-slots');
            
            const selectedPower = parseFloat(powerConsumptionSelect.value);
            let currentSlots = parseInt(slotsInput.value);

            if (selectedPower > 30) { // 120kW, 180kW, 360kW
                slotsInput.min = 2; // 至少2格
                slotsInput.step = 2; // 只能以2為步進

                // 如果當前值小於2或為奇數，則重設為2
                if (currentSlots < 2 || currentSlots % 2 !== 0) {
                    slotsInput.value = 2;
                }
            } else { // 7kW, 30kW
                slotsInput.min = 1; // 可以是1格
                slotsInput.step = 1; // 可以以1為步進
            }
            // Do NOT call calculateRevenue here
        }


        // JavaScript for scroll animation effect (Unchanged from previous versions)
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('.animate-on-scroll');

            const observerOptions = {
                root: null, // Observe the entire viewport
                rootMargin: '0px',
                threshold: 0.1 // Trigger when 10% of the element is visible
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        const subItems = entry.target.querySelectorAll('.bento-item');
                        subItems.forEach((item, index) => {
                            setTimeout(() => {
                                item.classList.add('is-visible');
                            }, index * 200);
                        });
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });

            // Interactive collapsible/expandable function (Accordion) (Unchanged from previous versions)
            const collapsibleHeaders = document.querySelectorAll('.collapsible-header');

            collapsibleHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.icon');

                    header.classList.toggle('expanded');
                    content.classList.toggle('expanded');

                    if (content.classList.contains('expanded')) {
                        content.style.maxHeight = content.scrollHeight + "px";
                    } else {
                        content.style.maxHeight = "0";
                    }
                });
            });

            // JavaScript for number animation (e.g., 1,700萬 and 9.8萬) (Unchanged from previous versions)
            function animateNumber(element, targetValue, unit, duration) {
                let startTimestamp = null;
                const startValue = parseFloat(element.querySelector('.current-value').textContent || '0');
                const difference = targetValue - startValue;
                const currentValueSpan = element.querySelector('.current-value');
                const isInteger = Number.isInteger(targetValue);

                function step(timestamp) {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const easedProgress = 0.5 - Math.cos(progress * Math.PI) / 2;

                    let currentValue = startValue + (easedProgress * difference);

                    if (isInteger) {
                        currentValueSpan.textContent = Math.round(currentValue).toLocaleString('en-US');
                    } else {
                        const decimalPlaces = (targetValue.toString().split('.')[1] || '').length;
                        currentValueSpan.textContent = currentValue.toFixed(decimalPlaces);
                    }
                    
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    } else {
                        if (isInteger) {
                            currentValueSpan.textContent = targetValue.toLocaleString('en-US');
                        } else {
                            currentValueSpan.textContent = targetValue.toFixed((targetValue.toString().split('.')[1] || '').length);
                        }
                    }
                }
                window.requestAnimationFrame(step);
            }

            // Observe elements with the 'animated-number' class
            const animatedNumberElements = document.querySelectorAll('.animated-number');

            const numberObserverOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.5
            };

            const numberObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const targetValue = parseFloat(element.dataset.targetValue);
                        const unit = element.dataset.unit;
                        const duration = 2000;

                        animateNumber(element, targetValue, unit, duration);
                    }
                });
            }, numberObserverOptions);

            animatedNumberElements.forEach(element => {
                numberObserver.observe(element);
            });

            // JavaScript for charging pile equipment diagrams (Unchanged from previous versions)
            const chargerTypeSelect = document.getElementById('charger-type');
            const chargerImage = document.getElementById('charger-image');

            const chargerImages = {
                '7kW': 'https://i.meee.com.tw/lImWom7.jpg',
                '30kW': 'https://i.meee.com.tw/lj9DcGE.jpg',
                '120kW': 'https://i.meee.com.tw/rzyjIOr.jpg',
                '180kW': 'https://i.meee.com.tw/PszN4JT.jpg',
                '360kW': 'https://i.meee.com.tw/5mffjMZ.jpg'
            };

            chargerImage.src = chargerImages['7kW'];
            chargerImage.alt = '7kW 充電樁設備圖';

            chargerTypeSelect.addEventListener('change', (event) => {
                const selectedValue = event.target.value;
                chargerImage.src = chargerImages[selectedValue];
                chargerImage.alt = `${selectedValue} 充電樁設備圖`;
            });


            // Calculator specific event listeners and initial setup
            const calcPowerConsumptionSelect = document.getElementById('calc-powerConsumption');
            const calcSlotsInput = document.getElementById('calc-slots');
            const calcYearsInput = document.getElementById('calc-years');
            const calcDailyVehicleCountPerSlotInput = document.getElementById('calc-dailyVehicleCountPerSlot');
            const calcAverageKWHPerVehicleChargeInput = document.getElementById('calc-averageKWHPerVehicleCharge');
            const calcChargingRateInput = document.getElementById('calc-chargingRate');
            const calcElectricityCostInput = document.getElementById('calc-electricityCost');
            const calcAnnualGrowthRateInput = document.getElementById('calc-annualGrowthRate'); // 新增年增率 input
            const calcInvestmentCostPerKWInput = document.getElementById('calc-investmentCostPerKW');
            const adminPassInput = document.getElementById('adminPass');

            // Function to hide results and chart when key public inputs change
            function hideCalculatorResults() {
                document.getElementById('calc-result').classList.add('hidden');
                document.getElementById('chart-container').classList.remove('visible'); // Hide chart using 'visible' class
                if (!isAdmin) { // Only hide admin section if not logged in
                    document.getElementById('admin-details-section').style.display = 'none';
                }
            }

            // Attach event listeners to power, slots, and years inputs for updating dependent fields AND hiding results
            calcPowerConsumptionSelect.addEventListener('change', () => {
                updateChargingRateBasedOnPower();
                updateDailyVehicleCountBasedOnPower();
                updateSlotsMinAndValue();
                hideCalculatorResults(); // Hide results immediately
            });

            calcSlotsInput.addEventListener('input', () => {
                const selectedPower = parseFloat(calcPowerConsumptionSelect.value);
                let currentSlots = parseInt(calcSlotsInput.value);

                if (selectedPower > 30) {
                    if (currentSlots % 2 !== 0) {
                        calcSlotsInput.value = Math.max(calcSlotsInput.min, currentSlots - 1);
                        if (currentSlots === 1) calcSlotsInput.value = 2;
                    }
                }
                hideCalculatorResults(); // Hide results immediately
            });

            calcYearsInput.addEventListener('change', hideCalculatorResults); // Hide results immediately
            calcYearsInput.addEventListener('input', hideCalculatorResults); // Hide results immediately
            calcYearsInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    hideCalculatorResults(); // Hide results immediately
                }
            });
            
            // Attach event listeners to admin-controlled inputs for updating dependent fields only
            const adminControlledInputs = [
                calcDailyVehicleCountPerSlotInput,
                calcAverageKWHPerVehicleChargeInput,
                calcChargingRateInput,
                calcElectricityCostInput,
                calcAnnualGrowthRateInput, // Add new input to event listeners
                calcInvestmentCostPerKWInput
            ];

            adminControlledInputs.forEach(input => {
                input.addEventListener('change', () => {
                    // No calculateRevenue() here, only update dependent states if needed
                    // Results will be hidden by the main button click or public input changes
                });
                input.addEventListener('blur', () => {
                    // No calculateRevenue() here
                });
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        // No calculateRevenue() here
                        e.preventDefault();
                    }
                });
            });


            // Listener for admin password input
            adminPassInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    loginAdmin();
                    e.preventDefault();
                }
            });

            // Initial setup for input states and calculation
            loadAdminParameters(); // Load saved parameters first
            updateChargingRateBasedOnPower(); // Set initial state for charging rate based on loaded power
            updateDailyVehicleCountBasedOnPower(); // Set initial state for daily vehicle count based on loaded power
            updateSlotsMinAndValue(); // Set initial state for slots based on loaded power
            setAdminInputStates(); // Set initial disabled states for admin inputs
            // Initially hide the results and admin section until calculation button is pressed or admin logs in
            hideCalculatorResults(); 
        });
    </script>
</body>
</html>
